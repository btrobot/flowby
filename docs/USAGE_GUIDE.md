# 测试重建系统使用指南

## 📚 给你（人类）

### 准备工作

把以下内容发送给有大量 tokens 的 AI：

```
你好！我需要你帮我重建一个 Python 项目的测试套件。

项目信息：
- 项目：Flowby DSL（Web 自动化 DSL）
- 代码库：E:\cf\ads\flowby
- 当前测试：1181 个，覆盖率 54%
- 目标：1400+ 个测试，覆盖率 80%+

所有文档和工具都已准备好：

1. **阅读这个文件开始**：docs/AI_INSTRUCTIONS.md
   - 这是你的工作手册
   - 包含所有需要知道的信息
   - 按照里面的步骤执行即可

2. **详细计划在这里**：docs/TEST_REBUILD_PLAN.md
   - 18 个详细任务
   - 每个任务都有示例代码
   - 验收标准清晰

3. **使用这些工具**：
   - scripts/task_tracker.py - 查看进度
   - scripts/quality_check.py - 检查质量
   - scripts/verify_tests.py - 验证通过

重要规则：
- 不要修改 src/ 目录下的业务代码
- 确保 pytest tests/ 始终全部通过
- 每个任务完成后运行质量检查

从 Task 1.1 开始，祝你工作顺利！

有问题随时问我。
```

### 检查 AI 的工作

AI 完成每个任务后，你需要做：

#### 1. 快速自动检查

```bash
# 切换到项目目录
cd E:\cf\ads\flowby

# 查看任务进度
python scripts/task_tracker.py status

# 运行质量检查
python scripts/quality_check.py <AI_创建的测试文件>

# 例如：
python scripts/quality_check.py tests/integration/test_runner.py
```

如果质量检查**分数 >= 80**，继续人工审查。
如果**分数 < 80**，让 AI 修改后再检查。

#### 2. 人工审查（可选但推荐）

打开 `docs/REVIEW_CHECKLIST.md`，按照清单逐项检查：

- 测试结构（10 分）
- 测试质量（10 分）
- 文档注释（6 分）
- 代码风格（4 分）

**总分 >= 24（80%）= 合格**

#### 3. 接受工作

如果质量合格：

```bash
# 接受 AI 的提交
git log -1  # 查看提交信息

# 如果满意，就完成了
# AI 会继续下一个任务
```

如果需要修改：

```markdown
## 反馈给 AI：

Task <ID> 需要改进：

1. <具体问题>
   - 位置：<文件:行号>
   - 建议：<改进建议>

2. ...

请修改后重新提交。
```

### 进度跟踪

随时查看整体进度：

```bash
python scripts/task_tracker.py status
```

输出示例：
```
============================================================
测试重建进度
============================================================
任务进度: 5/18 (27.8%)
覆盖率:   64.2% / 80.0%
============================================================

阶段进度:

准备工作: 3/3 ✅
  ✅ 1.1: 创建单元测试模板
  ✅ 1.2: 创建集成测试模板
  ✅ 1.3: 创建验证脚本

补充集成测试: 2/4 🚧
  ✅ 2.1: Runner 集成测试 (+59.0%, 52 tests)
  ✅ 2.2: Response Handler (+53.0%, 40 tests)
  ⏳ 2.3: Resource Integration
  ⏳ 2.4: Resilience
...
```

---

## 🤖 给 AI

请直接阅读 `docs/AI_INSTRUCTIONS.md` 开始工作。

---

## 📊 预期时间线

| 阶段 | 任务数 | 预计时间 | 覆盖率提升 |
|------|--------|----------|------------|
| Phase 1 | 3 | 1 小时 | - |
| Phase 2 | 4 | 8-10 小时 | +40% |
| Phase 3 | 2 | 10-12 小时 | +15% |
| Phase 4 | 2 | 6-8 小时 | +5% |
| Phase 5 | 2 | 15-20 小时 | +5% |
| Phase 6 | 3 | 4-6 小时 | - |
| **总计** | **18** | **44-57 小时** | **65%** |

---

## 🎯 里程碑

- [ ] **Week 1-2**: Phase 1-2 完成（覆盖率 → 70%）
- [ ] **Week 3-4**: Phase 3 完成（覆盖率 → 75%）
- [ ] **Week 5-6**: Phase 4 完成（覆盖率 → 78%）
- [ ] **Week 7-10**: Phase 5 完成（测试重构）
- [ ] **Week 11**: Phase 6 完成（文档工具）
- [ ] **最终验收**: 覆盖率 >= 80%，所有测试通过

---

## ❓ 常见问题

### Q: AI 遇到问题怎么办？

**A**: 让 AI 查看计划文档中的"常见问题"部分，或者查看测试模板中的示例。

### Q: 质量检查不通过怎么办？

**A**: 查看具体失败项，给 AI 明确的修改建议：

```
质量检查失败：Black 格式化不通过

请运行：
black <文件路径>

然后重新提交。
```

### Q: 覆盖率不达标怎么办？

**A**: 让 AI 查看覆盖率报告：

```
1. 运行：pytest --cov-report=html
2. 打开：htmlcov/index.html
3. 查看哪些代码未覆盖
4. 添加测试覆盖这些代码
```

### Q: 可以跳过某些任务吗？

**A**: 不建议，但如果必须：

- Phase 1 不能跳过（准备工作）
- Phase 2 优先级最高（覆盖率提升最大）
- Phase 3 重要
- Phase 4 可以后做（E2E 测试）
- Phase 5 可以后做（重构）
- Phase 6 可以部分跳过

---

## 📞 支持

- 查看文档：`docs/` 目录
- 运行工具：`scripts/` 目录
- 查看计划：`docs/TEST_REBUILD_PLAN.md`
- 查看清单：`docs/REVIEW_CHECKLIST.md`

---

**开始吧！让 AI 读 `docs/AI_INSTRUCTIONS.md` 即可！**
