/**meta
desc: 基本 OpenAPI 资源使用示例
version: 4.2
tags: [resource, openapi, basic]
*/

/**
 * 示例 1: 基本用法
 *
 * 演示如何使用 resource 语句引入 OpenAPI 定义的 API
 */

# 引入用户服务 API（使用 OpenAPI 规范）
resource user_api from "openapi/user-service.yml"

log "=== 示例 1: 获取单个用户 ==="

# 调用 API（类型安全，基于 OpenAPI 定义）
let user = user_api.getUser(userId=123)

log f"用户 ID: {user.id}"
log f"用户名: {user.name}"
log f"邮箱: {user.email}"
log f"已验证: {user.verified}"


log "\n=== 示例 2: 列出用户（分页）==="

# 带参数的 API 调用
let users_response = user_api.listUsers(page=1, limit=5, sort="created_desc")

log f"总共 {len(users_response.data)} 个用户"

for user in users_response.data:
    log f"  - {user.name} ({user.email})"
end for


log "\n=== 示例 3: 创建用户 ==="

# POST 请求（自动识别 request body）
let new_user = user_api.createUser(
    name="Bob",
    email="bob@example.com",
    password="SecurePass123!"
)

log f"新用户创建成功，ID: {new_user.id}"


log "\n=== 示例 4: 更新用户 ==="

# PUT 请求
let updated_user = user_api.updateUser(
    userId=new_user.id,
    name="Bob Updated",
    email="bob.updated@example.com"
)

log f"用户信息已更新: {updated_user.name}"


log "\n=== 示例 5: 验证用户邮箱 ==="

# POST 请求（带 path 参数和 body）
let verification = user_api.verifyUser(
    userId=new_user.id,
    verificationCode="123456"
)

log f"邮箱验证: {verification.verified}"


log "\n=== 所有示例执行完成 ==="
