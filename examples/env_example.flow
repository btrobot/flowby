"""
env() å‡½æ•°ä½¿ç”¨ç¤ºä¾‹ - v4.2.1

æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ env() å‡½æ•°è¯»å–ç¯å¢ƒå˜é‡ï¼Œé…åˆ .env æ–‡ä»¶ç®¡ç†é…ç½®ã€‚

ä½¿ç”¨è¯´æ˜ï¼š
1. å¤åˆ¶ .env.example ä¸º .env å¹¶é…ç½®å®é™…å€¼
2. è¿è¡Œæ­¤è„šæœ¬æŸ¥çœ‹ç¯å¢ƒå˜é‡è¯»å–æ•ˆæœ

ç›¸å…³æ–‡æ¡£ï¼š
- .env æ–‡ä»¶ä½ç½®ï¼šè„šæœ¬ç›®å½• > é¡¹ç›®æ ¹ç›®å½• > å½“å‰ç›®å½• > DOTENV_PATH
- ä¼˜å…ˆçº§ï¼šç³»ç»Ÿç¯å¢ƒå˜é‡ > .env æ–‡ä»¶ > é»˜è®¤å€¼
"""

# ==================== åŸºç¡€ç”¨æ³• ====================

# 1. è¯»å–ç¯å¢ƒå˜é‡ï¼ˆå¸¦é»˜è®¤å€¼ï¼‰
set api_token = env("API_TOKEN", "default_token")
log f"API Token: {api_token}"

# 2. è¯»å–ç¯å¢ƒå˜é‡ï¼ˆæ— é»˜è®¤å€¼ï¼Œä¸å­˜åœ¨æ—¶è¿”å› Noneï¼‰
set debug_mode = env("DEBUG")
log f"Debug Mode: {debug_mode}"

# 3. è¯»å–å¹¶è½¬æ¢ä¸ºç‰¹å®šç±»å‹
set port = int(env("PORT", "8000"))
log f"Server Port: {port} (type: integer)"

set timeout = float(env("API_TIMEOUT", "30"))
log f"API Timeout: {timeout} seconds (type: float)"

# ==================== å¾®æœåŠ¡é…ç½®ç¤ºä¾‹ ====================

# é…ç½®å¤šä¸ªå¾®æœåŠ¡çš„è¿æ¥ä¿¡æ¯
set account_url = env("ACCOUNT_SERVICE_URL", "http://localhost:8000")
set account_token = env("ACCOUNT_SERVICE_TOKEN", "dev_token")

set user_url = env("USER_SERVICE_URL", "http://localhost:8001")
set user_token = env("USER_SERVICE_TOKEN", "dev_token")

log "=== å¾®æœåŠ¡é…ç½® ==="
log f"Account Service: {account_url}"
log f"User Service: {user_url}"

# ==================== ç¯å¢ƒåˆ¤æ–­ ====================

# æ ¹æ®ç¯å¢ƒç±»å‹æ‰§è¡Œä¸åŒé€»è¾‘
set env_type = env("ENV", "development")

if env_type == "production"
    log "ğŸš€ ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ç”Ÿäº§é…ç½®"
    set max_retries = 5
    set log_level = "WARNING"
elif env_type == "development"
    log "ğŸ”§ å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨å¼€å‘é…ç½®"
    set max_retries = 1
    set log_level = "DEBUG"
else
    log "ğŸ§ª æµ‹è¯•ç¯å¢ƒï¼šä½¿ç”¨æµ‹è¯•é…ç½®"
    set max_retries = 3
    set log_level = "INFO"
end

log f"ç¯å¢ƒç±»å‹: {env_type}"
log f"æœ€å¤§é‡è¯•æ¬¡æ•°: {max_retries}"
log f"æ—¥å¿—çº§åˆ«: {log_level}"

# ==================== å¯é€‰é…ç½® ====================

# ä½¿ç”¨ env() å¤„ç†å¯é€‰é…ç½®
set screenshot_enabled = env("SCREENSHOT_ON_ERROR", "true")

if screenshot_enabled == "true"
    log "âœ“ é”™è¯¯æ—¶è‡ªåŠ¨æˆªå›¾å·²å¯ç”¨"
else
    log "âœ— é”™è¯¯æ—¶è‡ªåŠ¨æˆªå›¾å·²ç¦ç”¨"
end

# ==================== æ•°å€¼é…ç½® ====================

# è¯»å–æ•°å€¼ç±»å‹é…ç½®
set page_timeout = int(env("PAGE_LOAD_TIMEOUT", "30000"))
set retry_count = int(env("MAX_RETRIES", "3"))

log f"é¡µé¢åŠ è½½è¶…æ—¶: {page_timeout}ms"
log f"æœ€å¤§é‡è¯•æ¬¡æ•°: {retry_count}"

# ==================== è·¯å¾„é…ç½® ====================

# è¯»å–è·¯å¾„é…ç½®
set specs_dir = env("API_SPECS_DIR", "./examples")
log f"OpenAPI è§„èŒƒç›®å½•: {specs_dir}"

set screenshots_dir = env("SCREENSHOTS_DIR", "./screenshots")
log f"æˆªå›¾ä¿å­˜ç›®å½•: {screenshots_dir}"

# ==================== å¤šç¯å¢ƒé…ç½®ç¤ºä¾‹ ====================

"""
.env æ–‡ä»¶ç»„ç»‡ç¤ºä¾‹ï¼š

é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ .env                    # é»˜è®¤é…ç½®ï¼ˆå›¢é˜Ÿå…±äº«ï¼Œæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼‰
â”œâ”€â”€ .env.local             # æœ¬åœ°é…ç½®ï¼ˆä¸ªäººä¸“å±ï¼Œä¸æäº¤ï¼‰
â”œâ”€â”€ .env.production        # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ .env.development       # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ .env.test              # æµ‹è¯•ç¯å¢ƒé…ç½®
â””â”€â”€ .env.example           # é…ç½®æ¨¡æ¿ï¼ˆæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼‰

åŠ è½½ä¼˜å…ˆçº§ï¼ˆä»ä½åˆ°é«˜ï¼‰ï¼š
1. .envï¼ˆé»˜è®¤é…ç½®ï¼‰
2. .env.localï¼ˆæœ¬åœ°è¦†ç›–ï¼‰
3. .env.{ENV}ï¼ˆç¯å¢ƒç‰¹å®šé…ç½®ï¼‰
4. ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼Œä¸ä¼šè¢« .env è¦†ç›–ï¼‰

ç¤ºä¾‹ï¼š
- å¼€å‘æ—¶ä½¿ç”¨ .env.local è¦†ç›–å›¢é˜Ÿé»˜è®¤é…ç½®
- éƒ¨ç½²æ—¶é€šè¿‡ç¯å¢ƒå˜é‡ ENV=production åˆ‡æ¢åˆ°ç”Ÿäº§é…ç½®
- CI/CD ä¸­ä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡è¦†ç›–æ•æ„Ÿä¿¡æ¯
"""

log "âœ“ env() å‡½æ•°ç¤ºä¾‹æ‰§è¡Œå®Œæˆ"
