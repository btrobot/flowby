# ============================================================================
# Flowby V6 - Complete Examples
# ============================================================================
#
# Version: 6.6
# Last Updated: 2025-12-01
#
# This file demonstrates all major features added in v6.4, v6.5, and v6.6:
#
# v6.4 Features:
# - Lambda Expressions (x => expr, (x, y) => expr)
# - Core Collection Methods (filter, map, reduce, find, findIndex, some, every)
#
# v6.5 Features:
# - Extended Collection Methods (sort, reverse, slice, join, unique, length)
#
# v6.6 Features:
# - String Methods (capitalize, padStart, padEnd, repeat)
# - Array Utility Methods (flatten, chunk)
# - Dictionary Methods (keys, values, entries)
# - Global Utility Functions (zip, sleep)
#
# ============================================================================


# ============================================================================
# PART 1: Lambda Expressions (v6.4)
# ============================================================================

log info "=== Part 1: Lambda Expressions (v6.4) ==="

# Basic lambda syntax
let double = x => x * 2
let add = (x, y) => x + y
let is_positive = x => x > 0

log success "Basic lambdas defined"
log success f"double(5) = {double(5)}"           # 10
log success f"add(3, 7) = {add(3, 7)}"           # 10
log success f"is_positive(-5) = {is_positive(-5)}"  # False

# Lambdas with complex expressions
let get_discount = price => (price > 100) and (price * 0.1) or 0
let calculate_tax = (price, rate) => price * rate

let price = 120
log success f"Discount for ${price}: ${get_discount(price)}"
log success f"Tax (10%): ${calculate_tax(price, 0.1)}"

# Closures: lambdas capture outer scope
let multiplier = 3
let multiply_by_n = x => x * multiplier

log success f"multiply_by_n(5) = {multiply_by_n(5)}"  # 15

multiplier = 5  # Change outer variable
log success f"multiply_by_n(5) after change = {multiply_by_n(5)}"  # 25


# ============================================================================
# PART 2: Core Collection Methods (v6.4)
# ============================================================================

log info "\\n=== Part 2: Core Collection Methods (v6.4) ==="

# Sample data
let numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
let users = [
    {name: "Alice", age: 25, active: True},
    {name: "Bob", age: 30, active: False},
    {name: "Charlie", age: 35, active: True},
    {name: "David", age: 28, active: True}
]

# filter() - Filter elements
log success "filter() - Select even numbers"
let evens = numbers.filter(x => x % 2 == 0)
log success f"Evens: {evens}"  # [2, 4, 6, 8, 10]

log success "filter() - Select active users"
let active_users = users.filter(u => u.active)
log success f"Active users: {active_users.length()} out of {users.length()}"

# map() - Transform elements
log success "\\nmap() - Double each number"
let doubled = numbers.filter(x => x <= 5).map(x => x * 2)
log success f"Doubled (1-5): {doubled}"  # [2, 4, 6, 8, 10]

log success "map() - Extract user names"
let names = users.map(u => u.name)
log success f"Names: {names.join(', ')}"

# reduce() - Accumulate/aggregate
log success "\\nreduce() - Sum of numbers"
let sum = numbers.reduce((acc, x) => acc + x, 0)
log success f"Sum: {sum}"  # 55

log success "reduce() - Total age of active users"
let total_age = users
    .filter(u => u.active)
    .map(u => u.age)
    .reduce((acc, age) => acc + age, 0)
log success f"Total age of active users: {total_age}"

# find() - Find first matching element
log success "\\nfind() - Find first number > 5"
let found = numbers.find(x => x > 5)
log success f"Found: {found}"  # 6

log success "find() - Find user named Bob"
let bob = users.find(u => u.name == "Bob")
log success f"Found: {bob.name}, age {bob.age}"

# findIndex() - Find index of first match
log success "\\nfindIndex() - Find index of first > 5"
let index = numbers.findIndex(x => x > 5)
log success f"Index: {index}"  # 5

# some() - Check if any element matches
log success "\\nsome() - Any number > 8?"
let has_large = numbers.some(x => x > 8)
log success f"Has number > 8: {has_large}"  # True

log success "some() - Any inactive user?"
let has_inactive = users.some(u => not u.active)
log success f"Has inactive user: {has_inactive}"  # True

# every() - Check if all elements match
log success "\\nevery() - All numbers positive?"
let all_positive = numbers.every(x => x > 0)
log success f"All positive: {all_positive}"  # True

log success "every() - All users active?"
let all_active = users.every(u => u.active)
log success f"All active: {all_active}"  # False


# ============================================================================
# PART 3: Extended Collection Methods (v6.5)
# ============================================================================

log info "\\n=== Part 3: Extended Collection Methods (v6.5) ==="

# sort() - Sort array
log success "sort() - Sort numbers ascending"
let unsorted = [3, 1, 4, 1, 5, 9, 2, 6]
let sorted = unsorted.sort()
log success f"Sorted: {sorted}"  # [1, 1, 2, 3, 4, 5, 6, 9]

log success "sort() - Sort users by age"
let sorted_users = users.sort((a, b) => a.age - b.age)
let ages = sorted_users.map(u => u.age)
log success f"Ages (sorted): {ages}"  # [25, 28, 30, 35]

# reverse() - Reverse array
log success "\\nreverse() - Reverse numbers"
let reversed = [1, 2, 3, 4, 5].reverse()
log success f"Reversed: {reversed}"  # [5, 4, 3, 2, 1]

# slice() - Extract portion
log success "\\nslice() - Get middle elements"
let middle = numbers.slice(3, 7)
log success f"Middle (3-7): {middle}"  # [4, 5, 6, 7]

# join() - Join into string
log success "\\njoin() - Join user names"
let user_names = users.map(u => u.name).join(" | ")
log success f"Users: {user_names}"

# unique() - Remove duplicates
log success "\\nunique() - Remove duplicates"
let with_duplicates = [1, 2, 2, 3, 1, 4, 3, 5]
let unique_values = with_duplicates.unique()
log success f"Unique: {unique_values}"  # [1, 2, 3, 4, 5]

# length() - Get array length
log success "\\nlength() - Count elements"
let count = users.length()
log success f"Total users: {count}"


# ============================================================================
# PART 4: Method Chaining (v6.4 + v6.5)
# ============================================================================

log info "\\n=== Part 4: Method Chaining ==="

# Complex chaining example
log success "Chaining: filter -> map -> reduce"
let result = numbers
    .filter(x => x > 5)           # [6, 7, 8, 9, 10]
    .map(x => x * 2)              # [12, 14, 16, 18, 20]
    .reduce((acc, x) => acc + x, 0)  # 80
log success f"Result: {result}"

# Data transformation pipeline
log success "\\nData pipeline: filter active -> map names -> sort -> join"
let active_names = users
    .filter(u => u.active)
    .map(u => u.name)
    .sort()
    .join(", ")
log success f"Active users (sorted): {active_names}"

# Statistical analysis
log success "\\nStatistics: get top 3 scores >= 80"
let scores = [85, 92, 78, 95, 88, 91, 76, 89]
let top_3 = scores
    .filter(x => x >= 80)         # [85, 92, 95, 88, 91, 89]
    .sort()                       # [85, 88, 89, 91, 92, 95]
    .reverse()                    # [95, 92, 91, 89, 88, 85]
    .slice(0, 3)                  # [95, 92, 91]
log success f"Top 3 scores >= 80: {top_3}"


# ============================================================================
# PART 5: String Utility Methods (v6.6)
# ============================================================================

log info "\\n=== Part 5: String Utility Methods (v6.6) ==="

# capitalize() - First letter uppercase
log success "capitalize() - Title case"
let title = "hello flowby world"
let capitalized = title.capitalize()
log success f"'{title}' => '{capitalized}'"

# padStart() - Left-pad string
log success "\\npadStart() - Zero-padding"
let id = "5"
let padded_id = id.padStart(4, "0")
log success f"ID: '{id}' => '{padded_id}'"

let month = "3"
let padded_month = month.padStart(2, "0")
log success f"Month: '{month}' => '{padded_month}'"

# padEnd() - Right-pad string
log success "\\npadEnd() - Right alignment"
let code = "A"
let padded_code = code.padEnd(5, "-")
log success f"Code: '{code}' => '{padded_code}'"

# repeat() - Repeat string
log success "\\nrepeat() - Generate patterns"
let separator = "=".repeat(50)
log success separator
log success "  Flowby v6.6 - Modern DSL  "
log success separator

let loading = ".".repeat(3)
log success f"Loading{loading}"


# ============================================================================
# PART 6: Array Utility Methods (v6.6)
# ============================================================================

log info "\\n=== Part 6: Array Utility Methods (v6.6) ==="

# flatten() - Flatten nested arrays
log success "flatten() - Flatten 2D array"
let nested = [[1, 2], [3, 4], [5, 6]]
let flat = nested.flatten()
log success f"Nested: {nested}"
log success f"Flat: {flat}"  # [1, 2, 3, 4, 5, 6]

log success "\\nflatten(depth) - Partial flattening"
let deep_nested = [1, [2, [3, [4]]]]
let flat_1 = deep_nested.flatten(1)
let flat_2 = deep_nested.flatten(2)
log success f"Original: {deep_nested}"
log success f"Flatten(1): {flat_1}"  # [1, 2, [3, [4]]]
log success f"Flatten(2): {flat_2}"  # [1, 2, 3, [4]]

# chunk() - Split into chunks
log success "\\nchunk() - Batch processing"
let items = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
let batches = items.chunk(3)
log success f"Items: {items}"
log success f"Batches (size 3): {batches}"  # [[1,2,3], [4,5,6], [7,8,9], [10]]


# ============================================================================
# PART 7: Dictionary Methods (v6.6)
# ============================================================================

log info "\\n=== Part 7: Dictionary Methods (v6.6) ==="

let user_data = {
    name: "Alice",
    age: 30,
    city: "New York",
    role: "developer",
    active: True
}

# keys() - Get all keys
log success "keys() - Get object keys"
let user_keys = user_data.keys()
log success f"Keys: {user_keys}"

# values() - Get all values
log success "\\nvalues() - Get object values"
let user_values = user_data.values()
log success f"Values: {user_values}"

# entries() - Get key-value pairs
log success "\\nentries() - Get key-value pairs"
let user_entries = user_data.entries()
log success "Entries:"
for entry in user_entries:
    log success f"  {entry[0]}: {entry[1]}"


# ============================================================================
# PART 8: Global Utility Functions (v6.6)
# ============================================================================

log info "\\n=== Part 8: Global Utility Functions (v6.6) ==="

# zip() - Combine arrays
log success "zip() - Combine multiple arrays"
let ids = [1, 2, 3, 4]
let names_list = ["Alice", "Bob", "Charlie", "David"]
let ages_list = [25, 30, 35, 28]

let combined = zip(ids, names_list, ages_list)
log success "Combined data:"
for row in combined:
    log success f"  ID: {row[0]}, Name: {row[1]}, Age: {row[2]}"

# sleep() - Pause execution
log success "\\nsleep() - Pause execution"
log success "Starting countdown..."
sleep(0.5)
log success "3..."
sleep(0.5)
log success "2..."
sleep(0.5)
log success "1..."
sleep(0.5)
log success "Done!"


# ============================================================================
# PART 9: Real-World Use Cases
# ============================================================================

log info "\\n=== Part 9: Real-World Use Cases ==="

# Use Case 1: Data Transformation Pipeline
log success "Use Case 1: Active Users Report"
let all_users = [
    {name: "alice", age: 25, active: True, role: "developer"},
    {name: "bob", age: 30, active: False, role: "designer"},
    {name: "charlie", age: 35, active: True, role: "manager"},
    {name: "david", age: 28, active: True, role: "developer"}
]

let active_report = all_users
    .filter(u => u.active)
    .map(u => u.name.capitalize())
    .sort()
    .join(" | ")

log success f"Active Users: {active_report}"

# Use Case 2: Statistical Analysis
log success "\\nUse Case 2: Score Statistics"
let test_scores = [85, 92, 78, 95, 88, 91, 76, 89, 93, 87]

let average = test_scores.reduce((acc, x) => acc + x, 0) / test_scores.length()
let passed = test_scores.filter(x => x >= 80).length()
let all_passed = test_scores.every(x => x >= 60)
let highest = test_scores.sort().reverse()[0]

log success f"Average: {average}"
log success f"Passed (>=80): {passed}/{test_scores.length()}"
log success f"All passed (>=60): {all_passed}"
log success f"Highest score: {highest}"

# Use Case 3: Batch Processing
log success "\\nUse Case 3: Batch Processing"
let task_ids = [101, 102, 103, 104, 105, 106, 107, 108, 109, 110]
let task_batches = task_ids.chunk(3)

log success f"Processing {task_ids.length()} tasks in {task_batches.length()} batches..."
let batch_num = 1
for batch in task_batches:
    log success f"Batch {batch_num}: {batch}"
    sleep(0.3)
    batch_num = batch_num + 1

log success "All batches processed!"

# Use Case 4: Data Formatting
log success "\\nUse Case 4: Table Formatting"
let table_headers = ["ID", "Name", "Score"]
let table_data = [
    ["1", "Alice", "95"],
    ["2", "Bob", "88"],
    ["3", "Charlie", "92"]
]

let separator_line = "-".repeat(35)
log success separator_line

let formatted_header = zip(table_headers, ["3", "10", "5"])
    .map(pair => pair[0].padEnd(Number(pair[1])))
    .join(" | ")
log success formatted_header
log success separator_line

for row in table_data:
    let formatted_row = row[0].padStart(3) + " | " + row[1].padEnd(10) + " | " + row[2].padStart(5)
    log success formatted_row

log success separator_line

# Use Case 5: Complex Data Aggregation
log success "\\nUse Case 5: Group and Aggregate"
let transactions = [
    {category: "food", amount: 25},
    {category: "transport", amount: 15},
    {category: "food", amount: 30},
    {category: "entertainment", amount: 50},
    {category: "transport", amount: 20},
    {category: "food", amount: 40}
]

let categories = transactions.map(t => t.category).unique().sort()
log success "Category Summary:"

for category in categories:
    let category_total = transactions
        .filter(t => t.category == category)
        .map(t => t.amount)
        .reduce((acc, amt) => acc + amt, 0)

    log success f"  {category.capitalize().padEnd(15)}: ${category_total}"


# ============================================================================
# Summary
# ============================================================================

log info "\\n=== Summary ==="
log success "âœ“ Lambda Expressions (v6.4)"
log success "âœ“ Core Collection Methods (v6.4): filter, map, reduce, find, findIndex, some, every"
log success "âœ“ Extended Collection Methods (v6.5): sort, reverse, slice, join, unique, length"
log success "âœ“ String Methods (v6.6): capitalize, padStart, padEnd, repeat"
log success "âœ“ Array Methods (v6.6): flatten, chunk"
log success "âœ“ Dictionary Methods (v6.6): keys, values, entries"
log success "âœ“ Global Functions (v6.6): zip, sleep"
log success "\\nðŸŽ‰ All v6.4/v6.5/v6.6 features demonstrated!"
